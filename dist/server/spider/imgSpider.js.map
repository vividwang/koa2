{"version":3,"sources":["../../../server/spider/imgSpider.js"],"names":["puppeteer","require","request","sleep","timer","Promise","setTimeout","resolve","userAget","browser","launch","page","newPage","setUserAgent","goto","waitUntil","waitForSelector","i","hover","res","evaluate","$","window","items","imgSrc","length","each","index","item","it","img","find","attr","push","pipe","createWriteStream","Math","random","close"],"mappings":";;AAAA;;;AAGA,IAAMA,YAAYC,QAAQ,WAAR,CAAlB;AACA,IAAMC,UAAUD,QAAQ,SAAR,CAAhB;;AAEA,CAAC,kBAAW;AACV,MAAME,QAAQ,eAARA,KAAQ,CAAMC,KAAN,EAAgB;AAC5B,WAAO,IAAIC,OAAJ,CAAY,mBAAW;AAC5BC,iBAAWC,OAAX,EAAoBH,KAApB;AACD,KAFM,CAAP;AAGD,GAJD;;AAMA,MAAMI,WAAW,2HAAjB;AACA,MAAMC,UAAU,MAAMT,UAAUU,MAAV,EAAtB;AACA,MAAMC,OAAO,MAAMF,QAAQG,OAAR,EAAnB;AACA,QAAMD,KAAKE,YAAL,CAAkBL,QAAlB,CAAN;AACA,QAAMG,KAAKG,IAAL,CAAU,mBAAV,EAA+B,EAACC,WAAW,cAAZ,EAA/B,CAAN;;AAEA,QAAMZ,MAAM,IAAN,CAAN;;AAEA,QAAMQ,KAAKK,eAAL,CAAqB,WAArB,CAAN;;AAEA,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,EAApB,EAAwBA,GAAxB,EAA6B;AAC3B,UAAMd,MAAM,GAAN,CAAN;AACA,UAAMQ,KAAKO,KAAL,CAAW,WAAX,CAAN;AACD;;AAED,MAAIC,MAAM,MAAMR,KAAKS,QAAL,CAAc,YAAM;AAClC,QAAIC,IAAIC,OAAOD,CAAf;;AAEA,QAAIE,QAAQF,EAAE,mBAAF,CAAZ;AACA,QAAIG,SAAS,EAAb;;AAEA,QAAID,MAAME,MAAN,IAAgB,CAApB,EAAuB;AACrBF,YAAMG,IAAN,CAAW,UAACC,KAAD,EAAQC,IAAR,EAAiB;AAC1B,YAAIC,KAAKR,EAAEO,IAAF,CAAT;AACA,YAAIE,MAAMD,GAAGE,IAAH,CAAQ,KAAR,EAAeC,IAAf,CAAoB,KAApB,CAAV;;AAEAR,eAAOS,IAAP,CAAYH,GAAZ;AACD,OALD;AAMD;AACD,WAAO,EAACN,QAAQA,MAAT,EAAP;AACD,GAfe,CAAhB;;AAiBA,OAAK,IAAIP,KAAI,CAAb,EAAgBA,KAAIE,IAAIK,MAAJ,CAAWC,MAA/B,EAAuCR,IAAvC,EAA4C;AAC1Cf,YAAQiB,IAAIK,MAAJ,CAAWP,EAAX,CAAR,EAAuBiB,IAAvB,CAA4BjC,QAAQ,IAAR,EAAckC,iBAAd,CAAgCC,KAAKC,MAAL,KAAgB,MAAhD,CAA5B;AACD;AACD,QAAM5B,QAAQ6B,KAAR,EAAN;AACD,CA3CD","file":"imgSpider.js","sourcesContent":["/**\n * Created by w on 2018/3/30.\n */\nconst puppeteer = require('puppeteer');\nconst request = require('request');\n\n(async() => {\n  const sleep = async(timer) => {\n    return new Promise(resolve => {\n      setTimeout(resolve, timer);\n    })\n  };\n\n  const userAget = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36';\n  const browser = await puppeteer.launch();\n  const page = await browser.newPage();\n  await page.setUserAgent(userAget);\n  await page.goto('http://douban.com', {waitUntil: 'networkidle2'});\n\n  await sleep(3000);\n\n  await page.waitForSelector('.get-more');\n\n  for (let i = 0; i < 30; i++) {\n    await sleep(500);\n    await page.hover('.get-more');\n  }\n\n  let res = await page.evaluate(() => {\n    let $ = window.$;\n\n    let items = $('.grid-tweet-media');\n    let imgSrc = [];\n\n    if (items.length >= 1) {\n      items.each((index, item) => {\n        let it = $(item);\n        let img = it.find('img').attr('src');\n\n        imgSrc.push(img);\n      });\n    }\n    return {imgSrc: imgSrc};\n  });\n\n  for (let i = 0; i < res.imgSrc.length; i++) {\n    request(res.imgSrc[i]).pipe(require('fs').createWriteStream(Math.random() + '.png'));\n  }\n  await browser.close();\n})();"]}