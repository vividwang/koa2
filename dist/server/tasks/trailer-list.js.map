{"version":3,"sources":["../../../server/tasks/trailer-list.js"],"names":["puppeteer","require","url","sleep","timer","Promise","setTimeout","resolve","console","log","browser","launch","args","dumpio","page","newPage","goto","waitUntil","waitForSelector","i","click","result","evaluate","$","window","items","links","length","each","index","item","it","doubanId","find","data","title","text","rate","Number","poster","attr","replace","push","close"],"mappings":";;AAAA;;;AAGA,IAAMA,YAAYC,QAAQ,WAAR,CAAlB;AACA,IAAMC,MAAM,yDAAZ;;AAEA,IAAMC,QAAQ,eAARA,KAAQ,CAAMC,KAAN,EAAgB;AAC5B,SAAO,IAAIC,OAAJ,CAAY,mBAAW;AAC5BC,eAAWC,OAAX,EAAoBH,KAApB;AACD,GAFM,CAAP;AAGD,CAJD;;AAMA,CAAC,kBAAW;AACVI,UAAQC,GAAR,CAAY,6BAAZ;;AAEA,MAAMC,UAAU,MAAMV,UAAUW,MAAV,CAAiB;AACrCC,UAAM,CAAC,cAAD,CAD+B;AAErCC,YAAQ;AAF6B,GAAjB,CAAtB;AAIA,MAAMC,OAAO,MAAMJ,QAAQK,OAAR,EAAnB;AACA,QAAMD,KAAKE,IAAL,CAAUd,GAAV,EAAe,EAACe,WAAW,cAAZ,EAAf,CAAN;;AAEA,QAAMd,MAAM,IAAN,CAAN;;AAEA,QAAMW,KAAKI,eAAL,CAAqB,OAArB,CAAN;;AAEA,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,CAApB,EAAuBA,GAAvB,EAA4B;AAC1B,UAAMhB,MAAM,IAAN,CAAN;AACA,UAAMW,KAAKM,KAAL,CAAW,OAAX,CAAN;AACD;;AAED,MAAMC,SAAS,MAAMP,KAAKQ,QAAL,CAAc,YAAM;AACrC,QAAIC,IAAIC,OAAOD,CAAf;AACA,QAAIE,QAAQF,EAAE,YAAF,CAAZ;AACA,QAAIG,QAAQ,EAAZ;;AAEA,QAAID,MAAME,MAAN,IAAgB,CAApB,EAAsB;AACpBF,YAAMG,IAAN,CAAW,UAACC,KAAD,EAAOC,IAAP,EAAc;AACvB,YAAIC,KAAKR,EAAEO,IAAF,CAAT;AACA,YAAIE,WAAWD,GAAGE,IAAH,CAAQ,KAAR,EAAeC,IAAf,CAAoB,IAApB,CAAf;AACA,YAAIC,QAAQJ,GAAGE,IAAH,CAAQ,QAAR,EAAkBG,IAAlB,EAAZ;AACA,YAAIC,OAAOC,OAAOP,GAAGE,IAAH,CAAQ,OAAR,EAAiBG,IAAjB,EAAP,CAAX;AACA,YAAIG,SAASR,GAAGE,IAAH,CAAQ,KAAR,EAAeO,IAAf,CAAoB,KAApB,EAA2BC,OAA3B,CAAmC,SAAnC,EAA6C,SAA7C,CAAb;;AAEAf,cAAMgB,IAAN,CAAW;AACTV,4BADS;AAETG,sBAFS;AAGTE,oBAHS;AAITE;AAJS,SAAX;AAMD,OAbD;AAcD;;AAED,WAAOb,KAAP;AACD,GAvBkB,CAArB;;AA0BA,QAAMhB,QAAQiC,KAAR,EAAN;AACAnC,UAAQC,GAAR,CAAYY,MAAZ;AAED,CAhDD","file":"trailer-list.js","sourcesContent":["/**\n * Created by w on 2018/4/2.\n */\nconst puppeteer = require('puppeteer');\nconst url = 'https://movie.douban.com/tag/#/?sort=S&range=6,10&tags=';\n\nconst sleep = async(timer) => {\n  return new Promise(resolve => {\n    setTimeout(resolve, timer);\n  });\n};\n\n(async() => {\n  console.log('start visit the mivie page!');\n\n  const browser = await puppeteer.launch({\n    args: ['--no-sandbox'],\n    dumpio: false\n  });\n  const page = await browser.newPage();\n  await page.goto(url, {waitUntil: 'networkidle2'});\n\n  await sleep(3000);\n\n  await page.waitForSelector('.more');\n\n  for (let i = 0; i < 1; i++) {\n    await sleep(3000);\n    await page.click('.more');\n  }\n\n  const result = await page.evaluate(() => {\n      let $ = window.$;\n      let items = $('.list-wp a');\n      let links = [];\n\n      if (items.length >= 1){\n        items.each((index,item)=>{\n          let it = $(item);\n          let doubanId = it.find('div').data('id');\n          let title = it.find('.title').text();\n          let rate = Number(it.find('.rate').text());\n          let poster = it.find('img').attr('src').replace('s_ratio','l_ratio');\n\n          links.push({\n            doubanId,\n            title,\n            rate,\n            poster\n          })\n        })\n      }\n\n      return links;\n    }\n  );\n\n  await browser.close();\n  console.log(result);\n\n})();\n"]}